import{_ as a,c as i,o as n,ae as e}from"./chunks/framework.Ck3L_38O.js";const g=JSON.parse('{"title":"AstrBot 主动回复插件","description":"","frontmatter":{},"headers":[],"relativePath":"主动回复插件.md","filePath":"主动回复插件.md"}'),t={name:"主动回复插件.md"};function l(o,s,p,r,c,d){return n(),i("div",null,[...s[0]||(s[0]=[e(`<h1 id="astrbot-主动回复插件" tabindex="-1">AstrBot 主动回复插件 <a class="header-anchor" href="#astrbot-主动回复插件" aria-label="Permalink to &quot;AstrBot 主动回复插件&quot;">​</a></h1><p>一个支持聊天附带用户信息和定时主动发送消息的 AstrBot 插件。</p><h2 id="功能特性" tabindex="-1">功能特性 <a class="header-anchor" href="#功能特性" aria-label="Permalink to &quot;功能特性&quot;">​</a></h2><h3 id="聊天附带用户信息" tabindex="-1">聊天附带用户信息 <a class="header-anchor" href="#聊天附带用户信息" aria-label="Permalink to &quot;聊天附带用户信息&quot;">​</a></h3><ul><li>自动在 AI 对话中附加用户信息（用户名、用户ID）</li><li>自动附加当前时间信息</li><li>支持自定义时间格式</li><li>支持自定义信息模板</li><li><strong>智能追加</strong>：不会覆盖现有人格设置，而是追加到系统提示末尾</li></ul><h3 id="智能主动对话系统" tabindex="-1">智能主动对话系统 <a class="header-anchor" href="#智能主动对话系统" aria-label="Permalink to &quot;智能主动对话系统&quot;">​</a></h3><ul><li><strong>基于LLM的智能生成</strong>：通过LLM生成个性化主动消息，不使用预设模板</li><li><strong>人格系统兼容</strong>：自动检测并组合AstrBot人格设置与主动对话指令</li><li><strong>多样化对话风格</strong>：支持多个主动对话提示词，随机选择不同的对话风格</li><li><strong>上下文感知</strong>：基于用户信息和对话历史生成更自然的主动消息</li><li><strong>历史记录功能增强</strong>：支持基于对话历史的智能主动消息生成 <ul><li>历史记录开关配置，可选择是否附带历史记录</li><li>可配置历史记录条数（默认10条，建议5-20条）</li><li>AI生成主动消息时会参考之前的对话历史，生成更加拟人和连贯的主动消息</li><li>使用AstrBot官方API安全地获取聊天记录</li><li>添加简洁的上下文说明，不干扰主动对话提示词的主导作用</li></ul></li><li><strong>对话历史记录</strong>：AI主动发送的消息会自动添加到对话历史中 <ul><li>解决了上下文断裂问题，用户下次发消息时AI能看到完整对话</li><li>支持多种保存方式，确保历史记录的可靠性</li></ul></li><li><strong>支持两种时间模式</strong>： <ul><li><strong>固定间隔模式</strong>：固定时间间隔，可选随机延迟</li><li><strong>随机间隔模式</strong>：每次在设定范围内随机选择等待时间（如1分钟到1小时随机）</li></ul></li><li>支持活跃时间段设置</li><li>支持多会话管理</li><li><strong>可视化配置管理</strong>：提示词和会话列表支持单独添加、编辑、删除</li></ul><h2 id="配置说明" tabindex="-1">配置说明 <a class="header-anchor" href="#配置说明" aria-label="Permalink to &quot;配置说明&quot;">​</a></h2><h3 id="用户信息附加设置" tabindex="-1">用户信息附加设置 <a class="header-anchor" href="#用户信息附加设置" aria-label="Permalink to &quot;用户信息附加设置&quot;">​</a></h3><ul><li><strong>时间格式</strong>：时间显示格式（Python datetime 格式）</li><li><strong>信息模板</strong>：用户信息的显示模板，支持占位符。会追加到现有系统提示末尾，不会覆盖人格设置 <ul><li>支持的占位符：<code>{username}</code>, <code>{user_id}</code>, <code>{time}</code>, <code>{platform}</code>, <code>{chat_type}</code></li></ul></li></ul><h3 id="智能主动对话设置" tabindex="-1">智能主动对话设置 <a class="header-anchor" href="#智能主动对话设置" aria-label="Permalink to &quot;智能主动对话设置&quot;">​</a></h3><ul><li><strong>启用功能</strong>：是否启用智能主动对话功能</li><li><strong>主动对话默认人格</strong>：当没有AstrBot人格时使用的默认人格设定</li><li><strong>主动对话提示词列表</strong>：多个提示词选项，系统会随机选择一个来指导LLM生成主动消息 <ul><li>支持可视化列表管理，每个提示词可单独添加、编辑、删除</li><li>支持 <code>{user_context}</code> 占位符来插入用户信息</li></ul></li><li><strong>历史记录功能</strong>： <ul><li><strong>是否附带历史记录</strong>：启用后，AI生成主动消息时会参考之前的对话历史</li><li><strong>附带的历史记录条数</strong>：控制获取最近多少条对话记录作为上下文（默认10条，建议5-20条）</li></ul></li><li><strong>时间模式</strong>：选择时间模式 <ul><li><code>fixed_interval</code>：固定间隔模式（传统模式）</li><li><code>random_interval</code>：随机间隔模式（新增）</li></ul></li><li><strong>固定间隔模式设置</strong>： <ul><li><strong>发送间隔</strong>：每隔多少分钟发送一次消息</li><li><strong>随机延迟</strong>：在基础间隔上增加随机延迟时间</li><li><strong>延迟范围</strong>：随机延迟的最小和最大值</li></ul></li><li><strong>随机间隔模式设置</strong>： <ul><li><strong>最小间隔</strong>：随机间隔的最小时间（分钟）</li><li><strong>最大间隔</strong>：随机间隔的最大时间（分钟）</li></ul></li><li><strong>目标会话列表</strong>：需要发送消息的会话ID列表 <ul><li>支持可视化列表管理，每个会话ID可单独添加、编辑、删除</li></ul></li><li><strong>活跃时间</strong>：只在指定时间段内发送消息</li></ul><h2 id="使用指南" tabindex="-1">使用指南 <a class="header-anchor" href="#使用指南" aria-label="Permalink to &quot;使用指南&quot;">​</a></h2><h3 id="指令说明" tabindex="-1">指令说明 <a class="header-anchor" href="#指令说明" aria-label="Permalink to &quot;指令说明&quot;">​</a></h3><p>插件提供了9个主要指令，按功能分组：</p><h4 id="核心功能指令-6个" tabindex="-1">核心功能指令（6个） <a class="header-anchor" href="#核心功能指令-6个" aria-label="Permalink to &quot;核心功能指令（6个）&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/proactive help            # 显示帮助信息</span></span>
<span class="line"><span>/proactive status          # 查看插件状态和当前会话信息</span></span>
<span class="line"><span>/proactive config          # 显示完整的插件配置信息</span></span>
<span class="line"><span>/proactive add_session     # 将当前会话添加到定时发送列表</span></span>
<span class="line"><span>/proactive remove_session  # 将当前会话从定时发送列表移除</span></span>
<span class="line"><span>/proactive restart         # 重启定时任务（配置更改后必须使用）</span></span></code></pre></div><h4 id="测试功能指令-1个指令-6种功能" tabindex="-1">测试功能指令（1个指令，6种功能） <a class="header-anchor" href="#测试功能指令-1个指令-6种功能" aria-label="Permalink to &quot;测试功能指令（1个指令，6种功能）&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/proactive test [type]     # 统一测试指令</span></span>
<span class="line"><span>  • test 或 test basic     # 基础测试发送</span></span>
<span class="line"><span>  • test llm               # 测试LLM请求，体验用户信息附加功能</span></span>
<span class="line"><span>  • test generation        # 测试LLM生成主动消息功能</span></span>
<span class="line"><span>  • test prompt            # 测试系统提示词构建过程（包含历史记录）</span></span>
<span class="line"><span>  • test placeholders      # 测试占位符替换功能</span></span>
<span class="line"><span>  • test history           # 测试对话历史记录功能</span></span></code></pre></div><h4 id="显示功能指令-1个指令-2种功能" tabindex="-1">显示功能指令（1个指令，2种功能） <a class="header-anchor" href="#显示功能指令-1个指令-2种功能" aria-label="Permalink to &quot;显示功能指令（1个指令，2种功能）&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/proactive show [type]     # 统一显示指令</span></span>
<span class="line"><span>  • show prompt            # 显示当前配置下会输入给LLM的组合话术</span></span>
<span class="line"><span>  • show users             # 显示记录的用户信息</span></span></code></pre></div><h4 id="管理功能指令-1个指令-8种操作" tabindex="-1">管理功能指令（1个指令，8种操作） <a class="header-anchor" href="#管理功能指令-1个指令-8种操作" aria-label="Permalink to &quot;管理功能指令（1个指令，8种操作）&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/proactive manage [action] # 统一管理指令</span></span>
<span class="line"><span>  基础管理操作：</span></span>
<span class="line"><span>  • manage clear           # 清除记录的用户信息和发送时间</span></span>
<span class="line"><span>  • manage task_status     # 检查定时任务状态</span></span>
<span class="line"><span>  • manage force_stop      # 强制停止所有定时任务</span></span>
<span class="line"><span>  • manage force_start     # 强制启动定时任务</span></span>
<span class="line"><span>  • manage save_config     # 强制保存配置文件</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  故障排查操作：</span></span>
<span class="line"><span>  • manage debug_info      # 调试用户信息（查看AI收到的信息）</span></span>
<span class="line"><span>  • manage debug_send      # 调试发送功能（检查LLM生成过程）</span></span>
<span class="line"><span>  • manage debug_times     # 调试时间记录（查看发送时间记录）</span></span></code></pre></div><h3 id="快速开始" tabindex="-1">快速开始 <a class="header-anchor" href="#快速开始" aria-label="Permalink to &quot;快速开始&quot;">​</a></h3><ol><li><p><strong>配置用户信息模板</strong>：</p><ul><li>用户信息功能始终启用</li><li>在管理面板中自定义信息模板</li><li>通过模板控制显示哪些信息（用户名、ID、时间等）</li></ul></li><li><p><strong>设置智能主动对话</strong>：</p><ul><li>在管理面板中启用&quot;智能主动对话功能&quot;</li><li>配置主动对话默认人格（当无AstrBot人格时使用）</li><li>配置主动对话提示词列表（可添加多个不同风格的提示词）</li><li>选择时间模式： <ul><li><strong>固定间隔模式</strong>：设置固定间隔时间，可选随机延迟</li><li><strong>随机间隔模式</strong>：设置最小和最大间隔时间，每次随机选择</li></ul></li><li>设置活跃时间段（如 9:00-22:00）</li><li>使用 <code>/proactive status</code> 查看当前会话状态</li><li>使用 <code>/proactive add_session</code> 添加当前会话到发送列表</li></ul></li><li><p><strong>测试功能</strong>：</p><ul><li>使用 <code>/proactive manage debug_info</code> 查看AI收到的用户信息</li><li>使用 <code>/proactive test llm</code> 实际测试用户信息附加功能</li><li>使用 <code>/proactive test generation</code> 测试LLM生成主动消息</li><li>使用 <code>/proactive test prompt</code> 查看系统提示词构建过程（包含历史记录）</li><li>使用 <code>/proactive test</code> 测试主动消息发送</li><li>使用 <code>/proactive status</code> 查看插件状态</li></ul></li></ol><h2 id="配置示例" tabindex="-1">配置示例 <a class="header-anchor" href="#配置示例" aria-label="Permalink to &quot;配置示例&quot;">​</a></h2><h3 id="用户信息模板示例" tabindex="-1">用户信息模板示例 <a class="header-anchor" href="#用户信息模板示例" aria-label="Permalink to &quot;用户信息模板示例&quot;">​</a></h3><p><strong>默认模板</strong>（推荐）：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[对话信息] 用户：{username}，时间：{time}</span></span></code></pre></div><p><strong>详细信息模板</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[对话信息] 用户：{username}（ID：{user_id}），时间：{time}，平台：{platform}（{chat_type}）</span></span></code></pre></div><p><strong>最简模板</strong>（只显示用户名）：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>用户：{username}</span></span></code></pre></div><p><strong>重要提示</strong>：</p><ul><li>用户信息会追加到现有系统提示的末尾，不会覆盖您设置的人格</li><li>建议保持模板简洁，避免与人格设置产生冲突</li><li>不想显示某项信息？直接从模板中删除对应的占位符即可！</li></ul><h3 id="主动对话提示词示例" tabindex="-1">主动对话提示词示例 <a class="header-anchor" href="#主动对话提示词示例" aria-label="Permalink to &quot;主动对话提示词示例&quot;">​</a></h3><p><strong>基础提示词列表</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>主动问候用户，询问近况</span></span>
<span class="line"><span>分享有趣话题，发起轻松对话</span></span>
<span class="line"><span>关心用户情况，温暖问候</span></span>
<span class="line"><span>友好交流，分享今日想法</span></span>
<span class="line"><span>轻松聊天，询问用户心情</span></span></code></pre></div><p><strong>详细提示词示例</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>现在你要主动向用户发起对话，就像一个朋友在问候一样。请生成一条简短（1-2句话）、自然、有趣的主动问候消息</span></span>
<span class="line"><span>请主动和用户聊天，询问他们的近况或分享一些有趣的话题，保持轻松友好的语调</span></span>
<span class="line"><span>作为朋友，请主动关心一下用户最近的情况，发起一个温暖的对话</span></span>
<span class="line"><span>请以轻松友好的方式主动和用户交流，可以分享一些有趣的内容或询问用户的想法</span></span></code></pre></div><p><strong>使用占位符的提示词示例</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>现在是 {current_time}，用户 {username} 上次发消息是在 {user_last_message_time}，请主动问候用户</span></span>
<span class="line"><span>{username} 在 {platform} 上已经有一段时间没有活跃了，上次发消息是 {user_last_message_time_ago}，请友好地询问近况</span></span>
<span class="line"><span>用户 {username} 在 {chat_type} 中，{user_last_message_time_ago} 发过消息，请生成一条温暖的问候消息</span></span>
<span class="line"><span>根据以下用户信息主动发起对话：{user_context}</span></span>
<span class="line"><span>用户 {username} {user_last_message_time_ago} 活跃过，现在是 {current_time}，请主动关心一下</span></span></code></pre></div><p><strong>主动对话提示词支持的占位符</strong>：</p><ul><li><code>{user_context}</code> - 完整的用户上下文信息（包含用户名、平台、时间等）</li><li><code>{user_last_message_time}</code> - 用户上次主动发送消息的时间</li><li><code>{user_last_message_time_ago}</code> - 用户上次主动发送消息的相对时间（如&quot;5分钟前&quot;、&quot;1小时前&quot;）</li><li><code>{username}</code> - 用户昵称</li><li><code>{platform}</code> - 平台名称（如：aiocqhttp、telegram等）</li><li><code>{chat_type}</code> - 聊天类型（群聊/私聊）</li><li><code>{ai_last_sent_time}</code> - AI上次发送消息的时间</li><li><code>{current_time}</code> - 当前时间</li></ul><p><strong>用户信息模板支持的占位符</strong>：</p><ul><li><code>{username}</code> - 用户名</li><li><code>{user_id}</code> - 用户ID</li><li><code>{time}</code> - 当前时间</li><li><code>{platform}</code> - 平台名</li><li><code>{chat_type}</code> - 聊天类型（群聊/私聊）</li></ul><h3 id="时间模式配置示例" tabindex="-1">时间模式配置示例 <a class="header-anchor" href="#时间模式配置示例" aria-label="Permalink to &quot;时间模式配置示例&quot;">​</a></h3><p><strong>固定间隔模式</strong>：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;timing_mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;fixed_interval&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;interval_minutes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">600</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;random_delay_enabled&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;min_random_minutes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;max_random_minutes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li>每600分钟（10小时）发送一次，额外随机延迟0-30分钟</li><li>实际间隔：600-630分钟（10-10.5小时）</li></ul><p><strong>随机间隔模式</strong>：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;timing_mode&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;random_interval&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;random_min_minutes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">600</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;random_max_minutes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1200</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li>每次在600-1200分钟（10-20小时）之间随机选择等待时间</li><li>更自然的发送节奏，模拟真实用户行为</li></ul><h2 id="测试指南" tabindex="-1">测试指南 <a class="header-anchor" href="#测试指南" aria-label="Permalink to &quot;测试指南&quot;">​</a></h2><h3 id="如何测试用户信息附加功能" tabindex="-1">如何测试用户信息附加功能 <a class="header-anchor" href="#如何测试用户信息附加功能" aria-label="Permalink to &quot;如何测试用户信息附加功能&quot;">​</a></h3><ol><li><p><strong>查看调试信息</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/proactive manage debug_info</span></span></code></pre></div><p>这个指令会显示：</p><ul><li>当前用户的原始信息（昵称、ID等）</li><li>插件配置状态</li><li>AI将收到的完整用户信息</li></ul></li><li><p><strong>实际测试LLM请求</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/proactive test llm</span></span></code></pre></div><p>这个指令会：</p><ul><li>发送一个测试消息给AI</li><li>自动附加用户信息</li><li>让您直接体验功能效果</li></ul></li><li><p><strong>查看日志</strong>： 在AstrBot日志中查看详细的用户信息添加过程</p></li></ol><h3 id="如何测试智能主动对话功能" tabindex="-1">如何测试智能主动对话功能 <a class="header-anchor" href="#如何测试智能主动对话功能" aria-label="Permalink to &quot;如何测试智能主动对话功能&quot;">​</a></h3><ol><li><p><strong>查看当前会话状态</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/proactive status</span></span></code></pre></div><p>会显示当前会话是否在发送列表中</p></li><li><p><strong>添加当前会话</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/proactive add_session</span></span></code></pre></div></li><li><p><strong>测试LLM生成</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/proactive test generation</span></span></code></pre></div></li><li><p><strong>预览完整提示词和历史记录</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/proactive show prompt</span></span></code></pre></div><p>这个指令会显示：</p><ul><li>完整的系统提示词构建过程</li><li>历史记录获取状态和预览</li><li>人格系统集成情况</li><li>与实际生成使用相同的逻辑</li></ul></li><li><p><strong>测试系统提示词构建</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/proactive test prompt</span></span></code></pre></div><p>包含历史记录处理的完整测试</p></li><li><p><strong>测试立即发送</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/proactive test</span></span></code></pre></div></li><li><p><strong>调试发送过程</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/proactive manage debug_send</span></span></code></pre></div></li><li><p><strong>查看状态</strong>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>/proactive status</span></span></code></pre></div><p>现在会显示历史记录功能的启用状态和配置信息</p></li></ol><h2 id="与-astrbot-系统的兼容性" tabindex="-1">与 AstrBot 系统的兼容性 <a class="header-anchor" href="#与-astrbot-系统的兼容性" aria-label="Permalink to &quot;与 AstrBot 系统的兼容性&quot;">​</a></h2><h3 id="人格系统深度集成" tabindex="-1">人格系统深度集成 <a class="header-anchor" href="#人格系统深度集成" aria-label="Permalink to &quot;人格系统深度集成&quot;">​</a></h3><ul><li><strong>智能人格检测</strong>：自动检测当前会话使用的AstrBot人格设置</li><li><strong>人格组合机制</strong>：将AstrBot人格提示词与主动对话指令智能组合</li><li><strong>默认人格支持</strong>：当无AstrBot人格时，使用配置的主动对话默认人格</li><li><strong>用户信息追加</strong>：用户信息追加到系统提示末尾，保持现有人格完整性</li><li><strong>支持所有人格</strong>：无论使用默认人格还是自定义人格，都能正常工作</li></ul><h3 id="对话管理兼容" tabindex="-1">对话管理兼容 <a class="header-anchor" href="#对话管理兼容" aria-label="Permalink to &quot;对话管理兼容&quot;">​</a></h3><ul><li><strong>保持对话连续性</strong>：不影响 AstrBot 的对话管理功能</li><li><strong>支持多会话</strong>：每个会话的用户信息独立处理</li><li><strong>历史记录完整</strong>：不影响对话历史的存储和检索</li></ul><h2 id="技术特性" tabindex="-1">技术特性 <a class="header-anchor" href="#技术特性" aria-label="Permalink to &quot;技术特性&quot;">​</a></h2><ul><li>完全符合 AstrBot 插件开发规范</li><li>使用官方 API，无任何非标准功能</li><li>支持异步处理和错误恢复</li><li>完整的日志记录和调试功能</li><li>优雅的资源清理</li><li><strong>人格系统深度集成</strong>：自动检测并组合AstrBot人格与主动对话指令</li><li><strong>智能LLM调用</strong>：使用底层LLM API生成个性化主动消息</li><li><strong>多格式配置解析</strong>：支持列表、JSON、传统换行格式的自动识别</li><li><strong>可视化配置管理</strong>：支持现代化的列表配置界面</li></ul><h3 id="q-为什么没有收到主动消息" tabindex="-1">Q: 为什么没有收到主动消息？ <a class="header-anchor" href="#q-为什么没有收到主动消息" aria-label="Permalink to &quot;Q: 为什么没有收到主动消息？&quot;">​</a></h3><p>A: 请检查：</p><ol><li>是否启用了主动发送功能</li><li>当前时间是否在活跃时间段内</li><li>是否已添加当前会话到发送列表</li><li>LLM服务是否正常工作</li><li>使用 <code>/proactive status</code> 查看定时任务状态</li></ol><h3 id="q-历史记录功能会消耗很多token吗" tabindex="-1">Q: 历史记录功能会消耗很多Token吗？ <a class="header-anchor" href="#q-历史记录功能会消耗很多token吗" aria-label="Permalink to &quot;Q: 历史记录功能会消耗很多Token吗？&quot;">​</a></h3><p>A: 历史记录功能的Token消耗是可控的：</p><ol><li><strong>默认设置</strong>：默认获取10条历史记录，通常消耗200-500个Token</li><li><strong>可配置数量</strong>：可以根据需要调整历史记录条数（1-50条）</li><li><strong>智能筛选</strong>：只获取最近的对话记录，避免无关内容</li><li><strong>开关控制</strong>：可以完全关闭历史记录功能，不消耗额外Token</li></ol><h3 id="q-如何优化主动消息的质量" tabindex="-1">Q: 如何优化主动消息的质量？ <a class="header-anchor" href="#q-如何优化主动消息的质量" aria-label="Permalink to &quot;Q: 如何优化主动消息的质量？&quot;">​</a></h3><p>A: 可以通过以下方式优化：</p><ol><li><strong>完善提示词</strong>：在主动对话提示词列表中添加更具体、个性化的提示词</li><li><strong>启用历史记录</strong>：让AI参考对话历史，生成更连贯的消息</li><li><strong>调整人格设置</strong>：配置合适的主动对话默认人格</li><li><strong>使用占位符</strong>：在提示词中使用 <code>{username}</code>, <code>{user_last_message_time_ago}</code> 等占位符</li><li><strong>测试和调试</strong>：使用 <code>/proactive test generation</code> 和 <code>/proactive show prompt</code> 测试效果</li></ol><h3 id="q-如何调试插件问题" tabindex="-1">Q: 如何调试插件问题？ <a class="header-anchor" href="#q-如何调试插件问题" aria-label="Permalink to &quot;Q: 如何调试插件问题？&quot;">​</a></h3><p>A: 使用以下调试指令：</p><ul><li><code>/proactive status</code> - 查看整体状态</li><li><code>/proactive config</code> - 显示完整配置信息</li><li><code>/proactive manage debug_info</code> - 查看用户信息处理</li><li><code>/proactive manage debug_send</code> - 调试LLM发送功能</li><li><code>/proactive manage debug_times</code> - 查看时间记录</li><li><code>/proactive test generation</code> - 测试LLM生成功能</li><li><code>/proactive test placeholders</code> - 测试占位符替换功能</li><li><code>/proactive manage task_status</code> - 检查定时任务状态</li></ul>`,77)])])}const u=a(t,[["render",l]]);export{g as __pageData,u as default};

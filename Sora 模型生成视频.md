# 柏拉图 Sora 视频生成插件
插件可以自动识别图片尺寸，默认时间15s。

本插件允许您的 AstrBot 接入**柏拉图 (Plato) API**，使用强大的 **Sora 2 系列模型**，提供高质量的 **文生视频** 和 **图生视频** 功能。（功能统一图生视频，检测到图片就是图生视频、没检测到就是文生视频）

它内置了完善的 API Key 轮询、用户/群组次数限制、每日签到、指令预设、黑白名单权限控制和代理支持，非常适合在聊天群中部署和管理。

**请仔细阅读安装说明的第 3 和第 4 步，这对于插件正常运行至关重要。**

## ✨ 功能特性

- **核心功能**:
  - **文生视频**: 根据文本提示词生成视频，默认生成 **15 秒**。
  - **图生视频**: 结合图片和文本提示词生成动态视频。
  - **自动识别比例**: 进行图生视频时，能自动识别原图是横屏、竖屏还是方屏，并生成对应比例的视频。
  - **高级参数**: 支持在提示词中通过括号传入 `(高清, 10s, 竖屏)` 等参数，自定义生成效果。
- **管理与限制**:
  - **指令预设**: 管理员可以轻松添加、删除、查看自定义的快捷指令，方便群员使用。
  - **每日签到**: 用户可通过 `#视频签到` 获取免费使用次数。
  - **多 Key 轮询**: 支持配置多个 API Key，并自动轮询使用，避免单个 Key 额度耗尽。
  - **次数限制**: 完善的**用户个人次数**和**群组共享次数**限制系统。
  - **次数管理**: 管理员可随时为用户或群组增加次数。
- **权限控制**:
  - 支持用户黑名单、用户白名单、群组白名单，实现精细化权限管理。
- **网络支持**:
  - 支持通过 HTTP/HTTPS 网络代理访问 API。

### 普通用户指令
-
    **生成视频**: `#生成视频 <提示词> [附带图片]`
        **文生视频**：`调用大模型能力直接让其使用soraAPI生成视频，通过自然语言对话即可。`
-   **生成视频**: `#生成视频 <提示词> [附带图片]`
    -   **文生视频**: `#生成视频 一只猫在弹钢琴` (默认生成15秒视频)
    -   **图生视频**: 发送一张图片，然后回复该图片并输入 `#生成视频` (插件会自动识别图片比例)
    -   **高级用法**: `#生成视频 一只猫在弹钢琴 (竖屏, 10s, 高清)`

-   **使用预设**: `#<预设触发词>` (例如: `#电影感`)
    -   管理员可通过指令添加多种预设，方便快速调用。

-   **每日福利**: `#视频签到`
    -   每天可使用一次，获取免费次数。

-   **查询次数**: `#视频查询次数`
    -   查询您个人和所在群聊的剩余使用次数。

-   **获取帮助**: `#视频帮助`
    -   查看本插件的帮助信息和所有指令。

### 管理员指令

**注意**: 需要将您的 QQ 号配置在 AstrBot 的全局配置文件 `global_config.json` 的 `admins_id` 列表中。

-   **增加用户次数**: `#视频增加用户次数 <QQ号> <次数>`
    -   示例: `#视频增加用户次数 123456 20`

-   **增加群组次数**: `#视频增加群组次数 <群号> <次数>`
    -   示例: `#视频增加群组次数 111111 100`

-   **添加/修改预设**: `#视频添加预设 <触发词>:<提示词>`
    -   示例: `#视频添加预设 电影感:cinematic, epic, 4k`

-   **删除预设**: `#视频删除预设 <触发词>`
    -   示例: `#视频删除预设 电影感`

-   **查看预设**: `#视频预设列表`

-   **清理缓存**: `#视频清除缓存`
    -   删除插件下载的所有临时视频文件。

## ❓ 常见问题 (FAQ)

1.  **机器人提示 "未配置任何 API 密钥"**
    > 请检查配置文件 `astrbot_plugin_plato_sora.json`，确保 `api_keys` 字段已正确填写您的密钥。

2.  **视频发送失败，或提示“文件消息缺少参数”、“识别URL失败”**
    > 这大概率是因为您没有正确配置 **“对外可达的回调接口地址”**。请严格按照上方 **【安装说明】的第 4 步** 进行检查和配置。这是确保机器人能正确找到并发送本地文件的关键。

3.  **提示 "次数已用尽"**
    > 这说明您的个人次数或所在群组的共享次数已经用完。您可以通过 `#视频签到` 获取免费次数，或联系机器人管理员为您增加次数。

4.  **机器人没有反应**
    > -   请检查 AstrBot 的后台日志，确认是否有报错信息。
    > -   检查您的指令是否符合格式，例如是否以 `#` 开头。
    > -   如果您设置了白名单，请确认您的 QQ 号或所在群号是否在白名单内。
    > -   确认您没有在黑名单内。

5.  **次数为0还能使用**
    > -   请检查您是否是管理员。管理员不受次数限制。
    > -   请检查插件配置，`enable_user_limit` (用户限制) 和 `enable_group_limit` (群组限制) 是否都已开启 (`true`)。
